---
format: 
  revealjs:
    slide-number: true
    theme: [default, custom_theme.scss]
    preview-links: auto
    output-file: "presentation"
    output-ext: "html"
    logo: "Materials/PalaeOpen_without_text.png"
    code-line-numbers: false
    code-overflow: wrap
    code-link: false
    embed-resources: true
    center-title-slide: false
---

```{r}
#| label: setup
#| include: false
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width = 7,
  fig.height = 5,
  fig.align = "center",
  out.width = "100%"
)

if(!require("countdown")) install.packages("countdown")

library(countdown)

# Load colors from JSON
if (!require("jsonlite")) install.packages("jsonlite")
library(jsonlite)

if(!require("qrcode")) install.packages("qrcode")
library(qrcode)

if(!require("here")) install.packages("here")

library(here)
here::i_am("Presentation/presentation.qmd")


include_local_figure <- function(data_source) {
  knitr::include_graphics(
    path = here::here(
      "Presentation/Materials",
      data_source
    ),
    error = TRUE
  )
}

```

```{r}
#| label: colors
#| include: false
library(jsonlite)

colors <- 
  jsonlite::fromJSON(
    here::here("Presentation/colors.json")
  )

writeLines(
  text = c(
    "// This file is auto-generated from colors.json. Do not edit directly.",
    paste0("$", names(colors), ": ", unname(colors), ";")
  ),
  con = here::here("Presentation/_colors.scss")
)
```

# {.bg-purple}

<br>
<br>
<br>

:::: {.columns}

::: {.column width="40%"}
:::

::: {.column width="60%"}

```{r}
#| label: github-logo-0
include_local_figure("PalaeOpen.png")
```

:::

::::

:::: {.r-hstack}
::: {data-id="box1" style="background: `r colors$white`; width: 120px; height: 15px; margin: 0px;"}
:::

::: {data-id="box2" style="background: `r colors$blue`; width: 550px; height: 15px; margin: 0px;"}
:::

::: {data-id="box3" style="background: `r colors$red`; width: 120px; height: 15px; margin: 0px;"}
:::

::: {data-id="box3" style="background: `r colors$black`; width: 120px; height: 15px; margin: 0px;"}
:::
::::

::: {.text-color-black .text-font-heading .text-size-heading3 .text-bold}
[Neotoma]{.text-bold .text-background-blue}: Basics with fossil pollen data

<br>

:::

:::: {.columns}

::: {.column width="40%"}

:::

::: {.column width="60%" .text-right .text-size-body}
[üë§](https://ondrejmottl.github.io/)Ond≈ôej Mottl

[04.07.2025]{.text-color-black}

[Prague]{.text-color-black}
:::

::::

## Made by Ond≈ôej Mottlüôã {.text-center} 

<br>

::: {.text-center}
Assistant Professor at [Charles University](https://cuni.cz/UK-1.html)

Head of üßë‚Äçüíª[Laboratory of Quantitative Ecology](https://ondrejmottl.github.io/lab/about_the_lab.html)

:::

<br>

:::: {.columns .text-left}

::: {.column width="60%"}
<br>

* üìß Ondrej.mottl(at)gmail.com
* ü¶ã [ondrejmottl.bsky.social](https://bsky.app/profile/ondrejmottl.bsky.social)
* üê± [Github OndrejMottl](https://github.com/OndrejMottl)
* üÜî [ORCID 0000-0002-9796-5081](https://orcid.org/0000-0002-9796-5081)
* üåê [bit.ly/ondrej_mottl](https://bit.ly/ondrej_mottl)
:::

::: {.column width="40%"}
```{r}
#| label: head photo
include_local_figure("head_photo.png")
```
:::

::::

::: {.footer}
photo by Vladim√≠r ≈†igut (CUNI)
:::

# Fossil pollen

```{r}
#| label: pollen-micor
knitr::include_graphics("https://scied.ucar.edu/sites/default/files/media/images/pollen-wikipedia.jpg")
```

::: footer
[Pollen: More Than Just an Allergen](https://scied.ucar.edu/learning-zone/how-climate-works/pollen-more-just-allergen)
:::

# [Palaeoecology]{.bold .r-fit-text} {.bg-blue}

## A window to the past

```{r}
#| label: lake-to-vegetation
include_local_figure("Lake to vegetation rate.jpg")
```

::: footer
[Art by Milan TvM](https://x.com/MilanaTvM)
:::

## A window to the past

```{r}
#| label: coring
include_local_figure("Coring map.jpg")
```

::: footer
Photos by John W. Williams (a,b,r); Steffen Wolters (c,d,f,g); Thomas Giesecke (e); Henry H. Hooghiemstra (h,l,n,o,q); Geoff Hope (i); Feli Hopf (j); Eric Colhoun (k), Sarah Ivory (m), Luciane Fontana (p).
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}
What is your experience with fossil pollen data?
:::

`r countdown(minutes = 3)`

# [Neotoma]{.bold .r-fit-text} {.bg-blue}

## Neotoma Paleoecology Database

```{r}
#| label: neotoma
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/neotoma-og-04-2022.jpg")
```

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## What does Neotoma store?

::: {.incremental}
* **'Raw' Observations** on a variety of different proxies (vertebrates, diatoms, [pollen]{.text-background-blue}, plant macrofossils, testate amoebae, ostracodes, etc.)
  * [number of identified specimens]{.text-background-purple}, minimum number of individuals, presence/absence
  * information about individual specimens, such as elements, specimen ID, or isotopic values
* **Taxon names**
* [**Dates**]{.text-background-red} (14C, 210Pb, etc.)
* **Age inferences**
* [Derived Variables (e.g July mean temperature, species richness)]{.strike}
* [Image files]{.strike}
:::

## Neotoma - spatio-temporal scale

```{r}
#| label: neotoma-spatio-temporal
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_1280xAUTO_fit_center-center_80_none/map-snapshot.png")
```

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## Neotoma - data access

```{r}
#| label: neotoma-data-access
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_1280xAUTO_fit_center-center_80_none/neotoma-software-stack.png")
```

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## Neotoma - data access

Three main ways to access data:

:::: {.columns}

::: {.column width="30%" .fragment}
[Neotoma Explorer](https://www.neotomadb.org/apps/explorer)

```{r}
#| label: neotoma-explorer
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_480x320_crop_center-center_80_none/preview-explorer.jpg")
```
:::

::: {.column width="30%" .fragment}
[Neotoma API](https://www.neotomadb.org/apps/api)

```{r}
#| label: neotoma-api
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_480x320_crop_center-center_80_none/preview-interact.jpg")
```
:::

::: {.column width="30%" .fragment}
[{neotoma2}](https://open.neotomadb.org/neotoma2/)

```{r}
#| label: neotoma2
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_480x320_crop_center-center_80_none/preview-r.jpg")
```
:::

::::

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## [Neotoma Explorer]{.r-fit-text} {.bg-blue .text-center}

## Neotoma Explorer

GUI for searching and downloading data.

```{r}
#| label: neotoma-explorer-screen
include_local_figure("neotoma_viewer.png")
```

## Note on practical exercises {.exercise .text-center}

```{r}
#| label: practical-exercise-note
include_local_figure("monkey_see_monkey_do_by_adiasarahma.png")
```

::: {.footer}
[image by adiasarahma](https://www.deviantart.com/adiasarahma/)
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}
GOAL: Download a pollen record from Neotoma Explorer.
:::

::: {.text-center}
[Neotoma explorer](https://apps.neotomadb.org/explorer/)
:::

## [Your turn!]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}
* Go to [Neotoma explorer](https://apps.neotomadb.org/explorer/)
* Dowload a pollen record from a site of your choice
   + try to specify a region (e.g. Europe) and a time period (e.g. Holocene)
* Save the record as SCV file 
:::

`r countdown(minutes = 15)`

## [Neotoma API]{.r-fit-text} {.bg-blue .text-center}

## Neotoma API

Notoma REST [API]{.text-background-blue} allows to directly send [SQL]{.text-background-purple} queries from the Neotoma server.

**SQL** (server) = **S**tructured **Q**uery **L**anguage 

**API** = **A**pplication **P**rogramming **I**nterface

```{r}
#| label: neotoma-api-screen
knitr::include_graphics("https://images.ctfassets.net/vwq10xzbe6iz/5sBH4Agl614xM7exeLsTo7/9e84dce01735f155911e611c42c9793f/rest-api.png")
```

::: footer
[REST APIs Explained](https://mannhowie.com/rest-api)
:::

## Database structure

```{r}
#| label: neotoma-database-structure-1
include_local_figure("neotoma_structure.svg")
```

::: footer
[The neotoma2 R Package](https://open.neotomadb.org/neotoma2/inst/doc/neotoma2-package.html)
:::


## Database structure

:::: {.columns}

::: {.column width="50%"}
This is how it looks like in reality.
:::

::: {.column width="50%"}

```{r}
#| label: neotoma-database-structure-2
include_local_figure("neotoma_structure_real.svg")
```

:::

::::

::: footer
[The neotoma2 R Package](https://open.neotomadb.org/neotoma2/inst/doc/neotoma2-package.html)
:::


## Database structure

:::: {.columns}

::: {.column width="40%"}
Our interest is [Dataset]{.text-background-blue} and [Samples]{.text-background-purple}.
:::

::: {.column width="60%"}

```{r}
#| label: neotoma-database-structure-3
include_local_figure("neotoma_structure_box.svg")
```

:::

::::

::: footer
[The neotoma2 R Package](https://open.neotomadb.org/neotoma2/inst/doc/neotoma2-package.html)
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}
GOAL: Get information about a pollen record using Neotoma API.
:::

:::{.text-center}
[Neotoma API (swagger interface)](https://api.neotomadb.org/api-docs/)

Use `/v2.0/data/datasets/{datasetid}` endpoint.
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}

* get a `datasetid` from a pollen record of your choice from Neotoma Explorer
* Go to [Neotoma API (swagger interface)](https://api.neotomadb.org/api-docs/)
* Dowload a JSON pollen record use `/v2.0/data/downloads/{datasetid}` endpoint and selected `datasetid`

:::

`r countdown(minutes = 3)`

# [Fossil pollen data in R]{.bold .r-fit-text} {.bg-blue}

## [Practical Exercise]{.r-fit-text .text-center} {.exercise}

:::{.r-fit-text .text-center}
GOAL: Get familiar with {neotoma2} R package.
:::

<br>

### Materials:

::: {.r-fit-text}

* [üíΩRaw R code](https://github.com/SSoQE/SSoQE-Exploring_Past_Vegetation_Using_Fossil_Pollen/blob/main/R/Exercises/01_neotoma2_basics.qmd)
* [üé®rendered R code](https://github.com/SSoQE/SSoQE-Exploring_Past_Vegetation_Using_Fossil_Pollen/blob/main/R/Exercises/01_neotoma2_basics.html.md)

:::

## [Age-depth model]{.r-fit-text} {.bg-blue .text-center}

## Age-depth modeling - Why?

To assign [**age**]{.text-background-blue} to each [**depth**]{.text-background-purple} in a [**core**]{.text-background-red}.

```{r}
#| label: core-age-depth
include_local_figure("yenv_a_1578547_f0004_oc.jpg")
```

::: footer
[Relict Anthropogenic Ecosystem from the Middle Ages: History of a Salt Marsh from Transylvania](http://dx.doi.org/10.1080/14614103.2019.1578547)
:::

## Age-depth modeling - How?

:::: {.columns}

::: {.column width="50%"}
```{r}
#| label: core-age-depth-3a
knitr::include_graphics("https://i0.wp.com/eos.org/wp-content/uploads/2021/01/Close-up-of-tree-rings.jpg")
```
:::

::: {.column width="50%"}
```{r}
#| label: core-age-depth-3b
knitr::include_graphics("https://blogs.egu.eu/network/geojenga/files/2014/12/Radioactivedecay1.jpg")
```
:::

::::

::: footer
Stock.com/Ja‚ÄôCrispy | Ascough, SUERC
:::

## Age-depth modeling - How

```{r}
#| label: core-age-depth-gif
include_local_figure("sequence.gif")
```

::: footer
[Chrono14](https://14chrono.org/radiocarbon-dating/age-depth-modelling/)
:::

## Radiocarbon dates - not a real age

```{r}
#| label: radiocarbon-dates
knitr::include_graphics("https://andrewcparnell.github.io/Bchron/articles/Bchron_files/figure-html/unnamed-chunk-9-1.png")
```

::: footer
[Bchron](https://andrewcparnell.github.io/Bchron/articles/Bchron.html)
:::

## Age depth model - example

```{r}
#| label: age-depth-model-example
knitr::include_graphics("https://andrewcparnell.github.io/Bchron/articles/Bchron_files/figure-html/unnamed-chunk-51-1.png")
```

::: footer
[Bchron](https://andrewcparnell.github.io/Bchron/articles/Bchron.html)
:::

## Age-depth modeling - example

```{r}
#| label: core-age-depth-gif-2
include_local_figure("Bayes.gif")
```

::: footer
[Chrono14](https://14chrono.org/radiocarbon-dating/age-depth-modelling/)
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}
GOAL: Create an age-depth model using {Bchron} package.
:::

<br>

### Materials:

::: {.r-fit-text}

* [üíΩRaw R code](https://github.com/SSoQE/SSoQE-Exploring_Past_Vegetation_Using_Fossil_Pollen/blob/main/R/Exercises/02_age_depth_model.qmd)
* [üé®rendered R code](https://github.com/SSoQE/SSoQE-Exploring_Past_Vegetation_Using_Fossil_Pollen/blob/main/R/Exercises/02_age_depth_model.html.md)

:::

# [Past Vegetation through time]{.bold .italic .r-fit-text} {.bg-blue}

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

Goal: Look at a temporal change of presence of selected taxon.

Work in groups and choose a taxon and region of your interest.

:::{.r-fit-text}
[üíΩRaw R code](https://github.com/SSoQE/SSoQE-Exploring_Past_Vegetation_Using_Fossil_Pollen/blob/main/R/Project/PastVegetationTroughTime.R)
:::

`r countdown(minutes = 20)`

## Note of multi-record analysis

```{r}
#| label: FOSSILPOL
include_local_figure("Workflow complete - 600ppi.png")
```

::: footer
art by [Milan TvM](https://x.com/MilanaTvM)
:::

## Note of multi-record analysis

:::: {.columns}

::: {.column width="50%"}

```{r}
#| label: FOSSILPOL-logo
include_local_figure("Logo FOSSILPOL regular - 600ppi.png")
```
:::

::: {.column width="50%"}

```{r}
#| label: FOSSILPOL-qr
include_local_figure("qr-fossilpol.png")
```
:::

::::

::: footer
[FOSSILPOL](bit.ly/FOSSILPOL)
:::

# [Outro]{.bold .r-fit-text} {.bg-blue}

## [Science School of Quantitative Ecology]{.text-center}

:::: {.columns}

::: {.column width="20%"}

```{r}
#| label: ssoqe-logo
knitr::include_graphics("https://ondrejmottl.github.io/SSoQE_website/photos/logo_v2.png")
```
:::

::: {.column width="80%"}

This presentation is created as part of SSoQE project.

More info at [Science School of Quantitative Ecology](https://bit.ly/SSoQE)

:::

::::

:::: {.columns}

::: {.column width="25%"}
:::

::: {.column width="50%"}
```{r}
#| label: ssoqe-photo
knitr::include_graphics("https://ondrejmottl.github.io/SSoQE_website/Previous/2024/FOTO-II.jpg")  
```
:::

::: {.column width="25%"}
:::

::::

## [Code]{.bold .r-fit-text} {.bg-blue}

::: {.r-fit-text}
[üò∏ Code for this presentartion is available on GitHub](https://github.com/PalaeOpen/Workshop-neotoma-basic-20250704)
[![](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
:::
