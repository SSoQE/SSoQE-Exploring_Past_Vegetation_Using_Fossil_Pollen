```{r}
#| label: setup
#| include: false
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width = 7,
  fig.height = 5,
  fig.align = "center",
  out.width = "100%"
)

library(countdown)

# Load required packages for QR code generation
if (!require("qrcode")) install.packages("qrcode")
library(qrcode)

if (!require("here")) install.packages("here")
library(here)
here::i_am("Presentation/presentation.qmd")

include_local_figure <- function(data_source) {
  knitr::include_graphics(
    path = here::here(
      "Presentation/Materials",
      data_source
    ),
    error = TRUE
  )
}

source(
  here::here("R/00_Config_file.R")
)

# Dynamic project name generation using {here}
project_name <- 
  basename(here::here())

# Create a cleaner display name for the lecture
display_name <- 
  gsub("SSoQE-", "", project_name) %>%
  gsub("_", " ", .) %>%
  tools::toTitleCase()

# Create dynamic URLs
github_url <- 
  paste0(
    "https://github.com/SSoQE/",
     project_name
  )

slides_url <- 
  paste0(
    "https://ssoqe.github.io/", 
    project_name, "/"
  )
```

# {.title}

<br>

:::: {.columns}

::: {.column width="80%"}
:::

::: {.column width="20%"}

```{r}
#| label: ssoqe-logo-title
include_local_figure("Logos/SSOQE_logo3.png")
```

:::

::::

:::: {.r-hstack}
::: {data-id="box1" style="background: `r ssoqe_cols['black']`; width: 135px; height: 15px; margin: 0px;"}
:::

::: {data-id="box2" style="background: `r ssoqe_cols['cambridge_blue']`; width: 405px; height: 15px; margin: 0px;"}
:::

::: {data-id="box3" style="background: `r ssoqe_cols['persian_green']`; width: 225px; height: 15px; margin: 0px;"}
:::

::: {data-id="box4" style="background: `r ssoqe_cols['satin_sheen_gold']`; width: 135px; height: 15px; margin: 0px;"}
:::
::::

::: {.text-color-white .text-font-heading .text-size-heading2 .text-bold}
`r display_name`
:::

:::: {.columns}

::: {.column width="20%"}

:::

::: {.column width="80%" .text-right .text-size-body}
[üë§](https://ondrejmottl.github.io/)Ond≈ôej Mottl

[Science School of Quantitative Ecology 2025]{.text-color-black}

[bit.ly/SSoQE](https://bit.ly/SSoQE){.text-color-black}
:::

::::



## This presentation {.title}

<br>

:::: {.columns}

::: {.column width="70%"}
::: {.r-fit-text}
[üò∏ Code on GitHub](`r github_url`)

[üñ•Ô∏è Slides](`r slides_url`)

[![](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
:::
:::

::: {.column width="30%"}
```{r}
#| label: qr_slides
qr_slides <-
  qrcode::qr_code(
    slides_url,
    ecl = "H"
  )

qrcode::generate_svg(
  qrcode = qr_slides,
  filename = here::here("Presentation/Materials/QR/qr_slides.svg"),
  foreground = ssoqe_cols['white'],
  background = ssoqe_cols['midnight_green']
)

include_local_figure("QR/qr_slides.svg")
```
:::

::::

## Fossil pollen

```{r}
#| label: pollen-micro
knitr::include_graphics("https://scied.ucar.edu/sites/default/files/media/images/pollen-wikipedia.jpg")
```

::: footer
[Pollen: More Than Just an Allergen](https://scied.ucar.edu/learning-zone/how-climate-works/pollen-more-just-allergen)
:::

# [Palaeoecology]{.text-bold .r-fit-text} {.title}

## A window to the past

```{r}
#| label: lake-to-vegetation
include_local_figure("Illustrations/Lake to vegetation rate.jpg")
```

::: footer
[Art by Milan TvM](https://x.com/MilanaTvM)
:::

## A window to the past

```{r}
#| label: coring
include_local_figure("Photos/Coring map.jpg")
```

::: footer
Photos by John W. Williams (a,b,r); Steffen Wolters (c,d,f,g); Thomas Giesecke (e); Henry H. Hooghiemstra (h,l,n,o,q); Geoff Hope (i); Feli Hopf (j); Eric Colhoun (k), Sarah Ivory (m), Luciane Fontana (p).
:::

## [Discussion]{.text-size-heading2} {.exercise .text-center}

<br>

:::{.r-fit-text}
What is your experience with fossil pollen data?
:::

`r countdown(minutes = 3)`

# [Neotoma]{.text-bold .r-fit-text} {.title}

## Neotoma Paleoecology Database

```{r}
#| label: neotoma
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/neotoma-og-04-2022.jpg")
```

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## What does Neotoma store?

::: {.incremental}
* **'Raw' Observations** on a variety of different proxies (vertebrates, diatoms, [pollen]{.text-highlight-midnightGreen}, plant macrofossils, testate amoebae, ostracodes, etc.)
  * [number of identified specimens]{.text-highlight-satinSheenGold}, minimum number of individuals, presence/absence
  * information about individual specimens, such as elements, specimen ID, or isotopic values
* **Taxon names**
* [**Dates**]{.text-highlight-persianGreen} (14C, 210Pb, etc.)
* **Age inferences**
* [Derived Variables (e.g July mean temperature, species richness)]{.strike}
* [Image files]{.strike}
:::

## Neotoma - spatio-temporal scale

```{r}
#| label: neotoma-spatio-temporal
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_1280xAUTO_fit_center-center_80_none/map-snapshot.png")
```

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## Neotoma - data access

```{r}
#| label: neotoma-data-access
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_1280xAUTO_fit_center-center_80_none/neotoma-software-stack.png")
```

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## Neotoma - data access

Three main ways to access data:

:::: {.columns}

::: {.column width="30%" .fragment}
[Neotoma Explorer](https://www.neotomadb.org/apps/explorer)

```{r}
#| label: neotoma-explorer
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_480x320_crop_center-center_80_none/preview-explorer.jpg")
```
:::

::: {.column width="30%" .fragment}
[Neotoma API](https://www.neotomadb.org/apps/api)

```{r}
#| label: neotoma-api
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_480x320_crop_center-center_80_none/preview-interact.jpg")
```
:::

::: {.column width="30%" .fragment}
[{neotoma2}](https://open.neotomadb.org/neotoma2/)

```{r}
#| label: neotoma2
knitr::include_graphics("https://www.neotomadb.org/assets/uploads/images/_480x320_crop_center-center_80_none/preview-r.jpg")
```
:::

::::

::: footer
[Neotoma Paleoecology Database](https://www.neotomadb.org/)
:::

## Database structure

```{r}
#| label: neotoma-database-structure-1
include_local_figure("Diagrams/neotoma_structure.svg")
```

::: footer
[The neotoma2 R Package](https://open.neotomadb.org/neotoma2/inst/doc/neotoma2-package.html)
:::


## Database structure

:::: {.columns}

::: {.column width="50%"}
This is how it looks like in reality.
:::

::: {.column width="50%"}

```{r}
#| label: neotoma-database-structure-2
include_local_figure("Diagrams/neotoma_structure_real.svg")
```

:::

::::

::: footer
[The neotoma2 R Package](https://open.neotomadb.org/neotoma2/inst/doc/neotoma2-package.html)
:::


## Database structure

:::: {.columns}

::: {.column width="40%"}
Our interest is [Dataset]{.text-highlight-midnightGreen} and [Samples]{.text-highlight-persianGreen}.
:::

::: {.column width="60%"}

```{r}
#| label: neotoma-database-structure-3
include_local_figure("Diagrams/neotoma_structure_box.svg")
```

:::

::::

::: footer
[The neotoma2 R Package](https://open.neotomadb.org/neotoma2/inst/doc/neotoma2-package.html)
:::

# [Fossil pollen data in R]{.text-bold .r-fit-text} {.title}

## [Code Exercise]{.text-size-heading2} {.exercise .text-center}

```{r}
#| label: make excercise paths
#| include: false
ex_0_path <- 
  paste0(github_url, "/blob/main/R/Exercises/")

ex_1_path <- 
  paste0(ex_0_path, "01_getting_data_with_neotoma2-online")

ex1_path_qmd <-
  paste0(ex_1_path, ".qmd")

ex1_path_html <-
  paste0(ex_1_path, ".html.md")

```

Note: This only works if you have an internet connection.

:::{.r-fit-text .text-center}
GOAL: Get familiar with {neotoma2} R package.
:::

<br>

### Materials:

::: {.r-fit-text}

* [üíΩRaw R code](`r ex1_path_qmd`)
* [üé®rendered R code](`r ex1_path_html`)

:::

## [Code Exercise]{.text-size-heading2} {.exercise .text-center}

```{r}
#| label: make excercise paths-2
#| include: false
ex_2_path <- 
  paste0(ex_0_path, "02_working_with_pollen_data-offline")

ex2_path_qmd <-
  paste0(ex_2_path, ".qmd")

ex2_path_html <-
  paste0(ex_2_path, ".html.md")
```

:::{.r-fit-text .text-center}
GOAL: Plot a pollen diagram.
:::

<br>

### Materials:

::: {.r-fit-text}

* [üíΩRaw R code](`r ex2_path_qmd`)
* [üé®rendered R code](`r ex2_path_html`)

:::

# [Age-depth model]{.r-fit-text} {.title .text-center}

## Age-depth modeling - Why?

To assign [**age**]{.text-highlight-midnightGreen} to each [**depth**]{.text-highlight-persianGreen} in a [**core**]{.text-highlight-cambridgeBlue}.

```{r}
#| label: core-age-depth
include_local_figure("Age_depth_models/yenv_a_1578547_f0004_oc.jpg")
```

::: footer
[Relict Anthropogenic Ecosystem from the Middle Ages: History of a Salt Marsh from Transylvania](http://dx.doi.org/10.1080/14614103.2019.1578547)
:::

## Age-depth modeling - How?

:::: {.columns}

::: {.column width="50%"}
```{r}
#| label: core-age-depth-3a
knitr::include_graphics("https://i0.wp.com/eos.org/wp-content/uploads/2021/01/Close-up-of-tree-rings.jpg")
```
:::

::: {.column width="50%"}
```{r}
#| label: core-age-depth-3b
knitr::include_graphics("https://blogs.egu.eu/network/geojenga/files/2014/12/Radioactivedecay1.jpg")
```
:::

::::

::: footer
Stock.com/Ja'Crispy | Ascough, SUERC
:::

## Age-depth modeling - How

```{r}
#| label: core-age-depth-gif
include_local_figure("Age_depth_models/sequence.gif")
```

::: footer
[Chrono14](https://14chrono.org/radiocarbon-dating/age-depth-modelling/)
:::

## Radiocarbon dates - not a real age

```{r}
#| label: radiocarbon-dates
knitr::include_graphics("https://andrewcparnell.github.io/Bchron/articles/Bchron_files/figure-html/unnamed-chunk-9-1.png")
```

::: footer
[Bchron](https://andrewcparnell.github.io/Bchron/articles/Bchron.html)
:::

## Age-depth modeling - example

```{r}
#| label: core-age-depth-gif-2
include_local_figure("Age_depth_models/Bayes.gif")
```

::: footer
[Chrono14](https://14chrono.org/radiocarbon-dating/age-depth-modelling/)
:::

## Age depth model - example

```{r}
#| label: age-depth-model-example
knitr::include_graphics("https://andrewcparnell.github.io/Bchron/articles/Bchron_files/figure-html/unnamed-chunk-51-1.png")
```

::: footer
[Bchron](https://andrewcparnell.github.io/Bchron/articles/Bchron.html)
:::

## [Code Exercise]{.text-size-heading2} {.exercise .text-center}

```{r}
#| label: make excercise paths-3
#| include: false
ex_3_path <- 
  paste0(ex_0_path, "03_age_depth_model-offline")

ex3_path_qmd <-
  paste0(ex_3_path, ".qmd")

ex3_path_html <-
  paste0(ex_3_path, ".html.md")
```

:::{.r-fit-text}
GOAL: Create an age-depth model using {Bchron} package.
:::

<br>

### Materials:

::: {.r-fit-text}

* [üíΩRaw R code](`r ex3_path_qmd`)
* [üé®rendered R code](`r ex3_path_html`)

:::

# [Past Vegetation through time]{.text-bold .text-italic .r-fit-text} {.title}

```{r}
#| label: past-vegetation-path
#| include: false

ex_4_path <- 
  paste0(github_url, "/blob/main/R/Project/PastVegetationThroughTime.R")
```

## [Code Exercise]{.text-size-heading2} {.exercise .text-center}

:::{.r-fit-text}
Goal: Look at a temporal change of presence of selected taxon.
:::

Work in groups and choose a taxon and region of your interest.

:::{.r-fit-text}
[üíΩRaw R code](`r ex_4_path`)
:::

`r countdown(minutes = 20)`

## Note of multi-record analysis

```{r}
#| label: FOSSILPOL
include_local_figure("Diagrams/Workflow complete - 600ppi.png")
```

::: footer
art by [Milan TvM](https://x.com/MilanaTvM)
:::

## Note of multi-record analysis

:::: {.columns}

::: {.column width="50%"}

```{r}
#| label: FOSSILPOL-logo
include_local_figure("Logos/Logo FOSSILPOL regular - 600ppi.png")
```
:::

::: {.column width="50%"}

```{r}
#| label: FOSSILPOL-qr
qr_fossilpol <-
  qrcode::qr_code(
    "https://bit.ly/FOSSILPOL",
    ecl = "H"
  )

qrcode::generate_svg(
  qrcode = qr_fossilpol,
  filename = here::here("Presentation/Materials/QR/qr_fossilpol.svg"),
  foreground = ssoqe_cols['black'],
  background = ssoqe_cols['white']
)

include_local_figure("QR/qr_fossilpol.svg")
```
:::

::::

::: footer
[FOSSILPOL](bit.ly/FOSSILPOL)
:::

## [Neotoma API]{.r-fit-text} {.title .text-center}

## Neotoma API

Neotoma REST [API]{.text-highlight-midnightGreen} allows to directly send [SQL]{.text-highlight-satinSheenGold} queries from the Neotoma server.

**SQL** (server) = **S**tructured **Q**uery **L**anguage 

**API** = **A**pplication **P**rogramming **I**nterface

```{r}
#| label: neotoma-api-screen
knitr::include_graphics("https://images.ctfassets.net/vwq10xzbe6iz/5sBH4Agl614xM7exeLsTo7/9e84dce01735f155911e611c42c9793f/rest-api.png")
```

::: footer
[REST APIs Explained](https://mannhowie.com/rest-api)
:::

## [Note on practical exercises]{.text-color-midnightGreen} {.bg-white}

```{r}
#| label: practical-exercise-note
include_local_figure("Exercise/monkey_see_monkey_do_by_adiasarahma.jpg")
```

::: footer
[image by adiasarahma](https://www.deviantart.com/adiasarahma/)
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}
GOAL: Get information about a pollen record using Neotoma API.
:::

:::{.text-center}
[Neotoma API (swagger interface)](https://api.neotomadb.org/api-Presentation/)

Use `/v2.0/data/datasets/{datasetid}` endpoint.
:::

## [Practical Exercise]{.r-fit-text} {.exercise .text-center}

:::{.r-fit-text}

* get a `datasetid` from a pollen record of your choice from Neotoma Explorer
* Go to [Neotoma API (swagger interface)](https://api.neotomadb.org/api-Presentation/)
* Download a JSON pollen record use `/v2.0/data/downloads/{datasetid}` endpoint and selected `datasetid`

:::

`r countdown(minutes = 10)`

# [Outro]{.text-bold .r-fit-text} {.title}

## About me

:::: {.columns}

::: {.column width="25%"}
```{r}
#| label: personal sticker
include_local_figure("Author/Ondrej_Mottl-transparent-shadow.png")
```

```{r}
#| label: linktree QR
qr_personal_web <-
  qrcode::qr_code(
    "https://bit.ly/ondrej_mottl",
    ecl = "H"
  )

qrcode::generate_svg(
  qrcode = qr_personal_web,
  filename = here::here("Presentation/Materials/QR/qr_personal_web.svg"),
  foreground = ssoqe_cols['black'],
  background = ssoqe_cols['white']
)

include_local_figure("QR/qr_personal_web.svg")
```
:::

::: {.column width="5%"}
:::

::: {.column width="70%"}
[Ond≈ôej Mottl]{.text-bold .r-fit-text .text-color-black}
Assistant Professor at [Charles University](https://cuni.cz/UK-1.html)

Head of the üßë‚Äçüíª [Laboratory of Quantitative Ecology](https://ondrejmottl.github.io/lab/about_the_lab.html)

* üìß Ondrej.mottl(at)gmail.com
* ü¶ã [ondrejmottl.bsky.social](https://bsky.app/profile/ondrejmottl.bsky.social)
* üê± [Github](https://github.com/OndrejMottl)
* üÜî [ORCID](https://orcid.org/0000-0002-9796-5081)
* üåê [Personal webpage](https://ondrejmottl.github.io/)
:::

::::
